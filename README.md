以下是根据论文中**表6-2至表6-11测试表**内容，逐条拆分并详细描述的测试用例，严格对应论文原文中的测试场景、输入操作和预期结果：

### **一、钱包连接测试（表6-2）**

#### 1. **连接钱包**

- **测试场景**：用户点击“连接钱包”按钮，选择MetaMask并完成授权。
- **输入及操作**：在系统前端点击“连接钱包”，调用MetaMask钱包插件并确认授权。
- **预期结果**：钱包地址正确显示在系统界面，页面自动跳转到系统首页，用户进入已登录状态。
- **依据**：论文6.3.1节“钱包连接测试”中“连接钱包”用例，验证钱包地址与用户身份绑定功能。

#### 2. **断开后重连**

- **测试场景**：用户断开钱包连接后，再次选择同一地址重新连接。
- **输入及操作**：点击“断开钱包”按钮中断连接，再次点击“连接钱包”并选择同一钱包地址授权。
- **预期结果**：系统恢复登录状态，显示的用户信息（如宠物列表、权限）与断开前一致，钱包地址保持不变。
- **依据**：论文6.3.1节“断开后重连”用例，验证会话状态持久化和重连逻辑。

#### 3. **切换钱包地址**

- **测试场景**：用户通过MetaMask切换至另一个钱包地址并重新授权。
- **输入及操作**：在MetaMask中切换到未关联的钱包地址，点击“连接钱包”并授权。
- **预期结果**：系统自动更新用户信息，显示新钱包地址关联的账户数据（如领养记录、救助请求），原地址数据不再显示。
- **依据**：论文6.3.1节“切换钱包地址”用例，验证多钱包地址切换时的用户数据隔离。

### **二、机构管理模块测试（表6-3）**

#### 1. **正常添加机构**

- **测试场景**：合约部署者添加新的宠物医院或救助站。
- **输入及操作**：调用`addInstitution`函数，传入参数：名称“宠物医院A”，类型0（医院），负责人地址`addr1`，地址“成都市双流区”，联系方式“000-000000”。
- **预期结果**：机构ID计数器递增（如从0→1），新机构信息存入`institutions`数组，可通过`getAllInstitutions`查询到新增记录。
- **依据**：论文6.3.2节“正常添加机构”用例，验证机构注册流程和数据存储。

#### 2. **重复添加相同机构**

- **测试场景**：尝试添加与已注册机构完全相同的信息。
- **输入及操作**：再次调用`addInstitution`，传入与已存在机构（如“宠物医院A”）完全一致的参数。
- **预期结果**：交易回滚，系统不新增机构ID，`institutions`数组无重复记录。
- **依据**：论文6.3.2节“重复添加相同机构”用例，验证机构唯一性校验（通过名称+负责人地址标识）。

#### 3. **非合约部署者添加机构**

- **测试场景**：非部署者账户尝试添加机构。
- **输入及操作**：普通用户账户（非合约部署者）调用`addInstitution`函数。
- **预期结果**：交易回滚，智能合约抛出错误“Only deployer can add institutions”，前端提示权限不足。
- **依据**：论文6.3.2节“非合约部署者添加机构”用例，验证`onlyDeployer`权限修饰器功能。

#### 4. **更新机构信息**

- **测试场景**：机构负责人修改机构名称、地址等信息。
- **输入及操作**：机构负责人调用`updateInstitution`，将机构名称改为“宠物医院A新名称”，地址改为“成都市武侯区”。
- **预期结果**：`institutions`数组中对应机构的字段更新，链上数据同步修改，通过`getInstitutionDetail`可查询到新信息。
- **依据**：论文6.3.2节“更新机构信息”用例，验证机构信息修改的可操作性和数据一致性。

#### 5. **非机构负责人更新信息**

- **测试场景**：机构普通员工（非负责人）尝试修改机构信息。
- **输入及操作**：机构普通员工账户调用`updateInstitution`，修改机构地址。
- **预期结果**：交易回滚，智能合约抛出“Only institution owner can update info”，前端提示“只有机构负责人能更改信息”。
- **依据**：论文6.3.2节“非机构负责人更新信息”用例，验证机构内部权限分级（负责人 vs 普通员工）。

#### 6. **删除存在关联用户的机构**

- **测试场景**：删除已关联员工的机构。
- **输入及操作**：调用`deleteInstitution`删除ID=1的机构（该机构存在员工`addr2`）。
- **预期结果**：机构信息从`institutions`数组中移除，员工`addr2`的`institutionId`字段清零，无法再以该机构身份操作。
- **依据**：论文6.3.2节“删除存在关联用户的机构”用例，验证级联删除逻辑（机构与用户关联解除）。

#### 7. **删除未注册机构**

- **测试场景**：调用删除功能时传入不存在的机构ID。
- **输入及操作**：调用`deleteInstitution(999)`，尝试删除ID=999的机构（实际最大ID为1）。
- **预期结果**：系统提示“Institution not found”，`institutions`数组无变化，ID计数器不递减。
- **依据**：论文6.3.2节“删除未注册机构”用例，验证无效ID的错误处理机制。

### **三、用户管理模块测试（表6-4）**

#### 1. **普通用户注册**

- **测试场景**：个人用户注册为普通用户。
- **输入及操作**：调用`setUserProfile`，传入参数：姓名“李四”，邮箱“lisi@example.com”，手机“13900139000”，用户类型0（普通用户），机构ID=0（无关联）。
- **预期结果**：用户ID计数器递增（如从0→1），`users`列表新增记录，`roleId`为1（普通用户权限），可登录系统并访问“我的宠物”等功能。
- **依据**：论文6.3.3节“普通用户注册”用例，验证基础用户注册流程。

#### 2. **机构用户注册**

- **测试场景**：用户注册为机构成员（如宠物医院员工）。
- **输入及操作**：调用`setUserProfile`，传入参数：姓名“王五”，邮箱“wangwu@example.com”，手机“13600136000”，用户类型1（机构用户），机构ID=1（关联已存在机构）。
- **预期结果**：用户ID递增至2，`roleId`为2（机构用户权限），`institutionId`为1，可访问机构管理相关功能（如救助记录录入）。
- **依据**：论文6.3.3节“机构用户注册”用例，验证机构用户与机构的关联逻辑。

#### 3. **机构用户关联无效机构**

- **测试场景**：注册时关联不存在的机构ID。
- **输入及操作**：调用`setUserProfile`，传入机构ID=999（未注册机构）。
- **预期结果**：交易回滚，智能合约抛出“Associated institution does not exist”，注册失败，用户ID不递增。
- **依据**：论文6.3.3节“机构用户关联无效机构”用例，验证机构ID有效性校验（需提前存在于`institutions`数组）。

#### 4. **用户修改个人信息**

- **测试场景**：已注册用户更新个人资料。
- **输入及操作**：用户1（“李四”）调用`updateUserProfile`，修改姓名为“李四新”，邮箱为“newlisi@example.com”。
- **预期结果**：`users`列表中用户1的字段更新，再次登录后显示新姓名和邮箱，其他权限不变。
- **依据**：论文6.3.3节“用户修改个人信息”用例，验证用户信息可维护性。

#### 5. **普通用户尝试修改角色为管理员**

- **测试场景**：普通用户试图提升自身权限为管理员。
- **输入及操作**：用户1（普通用户，`roleId=1`）调用`setUserRole(1, 3)`（管理员角色ID=3）。
- **预期结果**：交易回滚，系统提示“权限不足”，`roleId`保持为1，无法访问管理员功能（如用户冻结）。
- **依据**：论文6.3.3节“用户修改角色”用例，验证角色权限不可越权修改（仅管理员可分配角色）。

#### 6. **重复注册同一用户**

- **测试场景**：使用已注册的邮箱或手机号再次注册。
- **输入及操作**：再次调用`setUserProfile`，传入与用户1相同的邮箱“lisi@example.com”。
- **预期结果**：系统提示“用户已存在”，用户ID计数器不递增，`users`列表无重复记录。
- **依据**：论文6.3.3节“重复注册同一用户”用例，验证用户账户唯一性（通过邮箱/手机标识）。

#### 7. **普通用户删除机构账号**

- **测试场景**：普通用户尝试删除机构用户账号。
- **输入及操作**：用户1（普通用户）调用`deleteUser(2)`（删除机构用户“王五”）。
- **预期结果**：系统提示“只有管理员能进行操作”，交易失败，用户2（“王五”）仍存在于`users`列表。
- **依据**：论文6.3.3节“普通用户删除机构账号”用例，验证管理员专属权限（敏感操作限制）。

### **四、宠物管理模块测试（表6-5至表6-11）**

#### **4.1 宠物信息添加功能测试（表6-5）**

#### 1. **正常添加宠物信息**

- **测试场景**：用户登记新宠物的完整信息。
- **输入及操作**：调用`addPet`函数，传入参数：名称“花花”，物种“猫”，品种“英短”，性别“母”，年龄2，描述“性格温顺”，图片URL“ipfs://xxx”。
- **预期结果**：宠物ID递增至1，`pets`数组新增记录，`userPets[msg.sender][1]`为`true`，可在“我的宠物”查看详情。
- **依据**：论文6.3.4节“正常添加宠物信息”用例，验证宠物档案创建流程。

#### 2. **输入特殊字符（名称含@#$%）**

- **测试场景**：宠物名称包含非法字符。
- **输入及操作**：调用`addPet`，名称设为“花@#$%花”，其他参数正常。
- **预期结果**：前端校验拦截，提示“宠物名称输入不合法”，数据未上链，宠物ID不递增。
- **依据**：论文6.3.4节“输入特殊字符测试”用例，验证输入内容过滤（仅允许字母、数字、中文）。

#### 3. **年龄字段输入字母**

- **测试场景**：年龄字段填入非数字字符。
- **输入及操作**：调用`addPet`，年龄设为“abc”，其他参数正常。
- **预期结果**：智能合约验证失败，抛出“年龄格式错误”，交易回滚，宠物ID不递增。
- **依据**：论文6.3.4节“信息格式错误测试”用例，验证数值类型字段的格式校验。

#### 4. **必填项缺失（未填名称）**

- **测试场景**：未填写宠物名称即提交。
- **输入及操作**：调用`addPet`，名称参数留空，其他参数正常。
- **预期结果**：前端提示“宠物名称为必填项”，表单无法提交，数据未存储。
- **依据**：论文6.3.4节“必填项缺失测试”用例，验证必填字段（名称、物种、品种）的强制性。

#### **4.2 宠物信息修改功能测试（表6-6）**

#### 1. **宠物主人正常修改信息**

- **测试场景**：宠物主人更新宠物年龄、描述等信息。
- **输入及操作**：用户1（宠物“花花”主人）调用`updatePet(1, {age: 3, description: "活泼好动"})`。
- **预期结果**：`pets[1]`的年龄和描述字段更新，`lastUpdatedAt`时间戳刷新，修改记录上链可查。
- **依据**：论文6.3.4节“宠物主人正常修改信息”用例，验证所有权人对宠物数据的修改权限。

#### 2. **非宠物主人修改信息**

- **测试场景**：非主人账户尝试修改宠物信息。
- **输入及操作**：用户2（非“花花”主人）调用`updatePet(1, {age: 3})`。
- **预期结果**：智能合约抛出“Not the pet owner”，交易回滚，数据未修改。
- **依据**：论文6.3.4节“非宠物主人修改信息”用例，验证`onlyOwner`权限修饰器（仅限宠物所有者操作）。

#### **4.3 医疗记录添加功能测试（表6-7）**

#### 1. **正常添加医疗记录**

- **测试场景**：医院用户录入宠物诊断信息。
- **输入及操作**：医院员工（机构ID=1的用户）调用`addMedicalEvent(1, "感冒", "服用感冒药，每日三次", 50, ["ipfs://report.pdf"])`。
- **预期结果**：医疗事件ID递增至1，`medicalEvents`数组新增记录，`pets[1].medicalRecordIds`包含1，可在医疗记录模块按时间轴查看。
- **依据**：论文6.3.4节“正常添加医疗记录”用例，验证医疗数据上链流程。

#### 2. **诊断结果为空**

- **测试场景**：未填写诊断结果即提交。
- **输入及操作**：调用`addMedicalEvent(1, "", "治疗方案", 50, [])`。
- **预期结果**：智能合约抛出“Diagnosis cannot be empty”，交易回滚，医疗记录未添加。
- **依据**：论文6.3.4节“诊断结果为空测试”用例，验证核心医疗字段的非空性。

#### 3. **治疗方案不完整**

- **测试场景**：未填写治疗方案即提交。
- **输入及操作**：调用`addMedicalEvent(1, "感冒", "", 50, [])`。
- **预期结果**：智能合约抛出“Treatment cannot be empty”，交易回滚，医疗记录未添加。
- **依据**：论文6.3.4节“治疗方案不完整测试”用例，验证诊断与治疗的关联性。

#### 4. **费用为负数**

- **测试场景**：输入负费用值。
- **输入及操作**：调用`addMedicalEvent(1, "感冒", "治疗方案", -50, [])`。
- **预期结果**：智能合约抛出“费用不能为负数”，交易回滚，费用字段保持为0或默认值。
- **依据**：论文6.3.4节“费用为负数测试”用例，验证数值边界校验（费用≥0）。

#### 5. **非医院用户添加医疗记录**

- **测试场景**：普通用户（非医护人员）尝试录入医疗数据。
- **输入及操作**：用户1（普通用户）调用`addMedicalEvent(1, "感冒", "治疗方案", 50, [])`。
- **预期结果**：智能合约抛出“Caller is not a hospital staff member”，交易回滚，验证角色权限（仅机构类型为医院的用户可操作）。
- **依据**：论文6.3.4节“非医院用户添加医疗记录”用例，验证`onlyHospitalStaff`权限修饰器。

#### **4.4 救助请求发布功能测试（表6-8）**

#### 1. **正常发布救助请求**

- **测试场景**：用户提交流浪动物救助信息。
- **输入及操作**：调用`submitRescueRequest`，传入参数：位置“公园东门”，描述“发现受伤流浪猫”，图片列表`["ipfs://img1.jpg"]`，紧急程度1（一般）。
- **预期结果**：救助请求ID递增至1，状态为“pending”，`rescueRequests`数组新增记录，可在“动物救助”模块查看。
- **依据**：论文6.3.4节“正常发布救助请求”用例，验证救助流程的起点逻辑。

#### 2. **位置信息缺失**

- **测试场景**：未填写救助位置即提交。
- **输入及操作**：调用`submitRescueRequest`，位置参数留空，其他参数正常。
- **预期结果**：前端提示“位置信息为必填项”，表单无法提交，救助请求未创建。
- **依据**：论文6.3.4节“位置信息缺失测试”用例，验证地理位置信息的必要性（用于救助资源调度）。

#### **4.5 救助流程管理功能测试（表6-9）**

#### 1. **正常更新救助请求状态**

- **测试场景**：救助站员工更新救助状态（如从“pending”→“进行中”）。
- **输入及操作**：调用`updateRescueStatus(1, "进行中")`，传入救助请求ID=1和新状态。
- **预期结果**：`rescueRequests[1].status`更新为“进行中”，时间戳记录变更，前端显示状态标签颜色变化（如从黄色→蓝色）。
- **依据**：论文6.3.4节“正常更新救助请求状态”用例，验证状态机流转逻辑（pending→进行中→已完成等）。

#### 2. **更新为无效状态**

- **测试场景**：尝试设置系统未定义的状态值。
- **输入及操作**：调用`updateRescueStatus(1, "未知")`，传入无效状态“未知”。
- **预期结果**：智能合约验证失败，抛出“状态更新错误”，状态保持不变，前端提示“请选择有效状态”。
- **依据**：论文6.3.4节“更新为无效状态测试”用例，验证状态枚举值限制（仅允许预设值）。

#### **4.6 领养信息发布功能测试（表6-10）**

#### 1. **正常发布领养信息**

- **测试场景**：救助站发布可领养流浪动物信息。
- **输入及操作**：调用`publishAdoptionInfo`，传入参数：宠物ID=1（已完成救助的流浪动物），健康状态“良好”，领养状态“可领养”。
- **预期结果**：领养信息显示在“领养市场”页面，包含宠物照片、健康状态、救助历史等，潜在领养者可查看并提交申请。
- **依据**：论文6.3.4节“正常发布领养信息”用例，验证领养流程的信息公开机制。

#### 2. **宠物信息不完整**

- **测试场景**：未填写宠物品种即发布领养信息。
- **输入及操作**：调用`publishAdoptionInfo`，品种参数留空，其他参数正常。
- **预期结果**：前端提示“宠物品种为必填项”，信息未发布，验证领养信息完整性（品种、健康状态等为必填）。
- **依据**：论文6.3.4节“宠物信息不完整测试”用例，验证领养信息发布的字段校验。

#### **4.7 领养功能测试（表6-11）**

#### 1. **正常提交领养申请**

- **测试场景**：领养者申请领养可领养状态的宠物。
- **输入及操作**：用户1调用`submitAdoptionApplication(1)`，申请领养ID=1的宠物（状态为“可领养”）。
- **预期结果**：智能合约触发领养流程，`pets[1].adoptionStatus`更新为“待审核”，`adoptionEvents`记录新增申请，管理员可在后台查看审核队列。
- **依据**：论文6.3.4节“正常提交领养申请”用例，验证领养申请的全流程上链（申请→审核→转移所有权）。

#### 2. **申请已被领养的宠物**

- **测试场景**：对状态为“已领养”的宠物提交申请。
- **输入及操作**：宠物ID=1的状态已更新为“已领养”，用户2调用`submitAdoptionApplication(1)`。
- **预期结果**：智能合约抛出“该宠物已被领养”，交易回滚，申请未创建，前端提示“宠物状态不可领养”。
- **依据**：论文6.3.4节“申请已被领养宠物测试”用例，验证领养状态的实时有效性（不可重复申请）。

### **五、测试用例执行说明**

1. **工具与环境**：使用Hardhat框架编写测试脚本，连接以太坊测试网络（如Hardhat Network），通过`ethers.js`调用智能合约接口。
2. **断言重点**：
   - 验证区块链数据变更（如数组长度、字段值、事件日志）。
   - 捕获智能合约错误信息（如`revertedWith`），确保权限和业务逻辑正确。
3. **覆盖原则**：每个测试用例独立运行，覆盖“正常流程”和“异常边界”，确保系统在各种场景下的稳定性和安全性。

以上测试用例均严格对应论文原文，可直接用于Hardhat合约测试的编写，确保测试覆盖率与论文描述一致。
